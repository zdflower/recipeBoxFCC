<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Recipe Box</title>
    <link href="css/style.css" rel="stylesheet" />
<!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
  -->
    <script src="js/react.js"></script>
    <script src="js/react-dom.js"></script>
    <script src="js/babel.min.js"></script>

</head>

<body>
    <div id="root"></div>
    <script type="text/babel" >
/* Se supone que ingredients es una cadena de caracteres donde cada ingrediente está separado del resto por una coma */

              let recipesList = [{ "name": "Vanilla Cookies", "ingredients": "butter, flour, eggs, vanilla, sugar, milk" }, { "name": "Chocolate Cookies", "ingredients": "butter, flour, eggs, chocolate, sugar, milk" }, { "name": "Algarroba Cookies", "ingredients": "butter, flour, eggs, algarroba flour, sugar, milk" }, { "name": "Cinnamon Cookies", "ingredients": "butter, flour, eggs, cinnamon, sugar, milk" }];

/* 
https://forum.freecodecamp.org/t/store-data-in-web-browsers-storage/16154

https://stackoverflow.com/questions/3357553/how-do-i-store-an-array-in-localstorage
*/

// localStorage.setItem('recipes', JSON.stringify(recipesList));

    class Page extends React.Component {
          constructor() { 
            super();
            this.state = {
              recipes : '' /* JSON.parse(localStorage.getItem('recipes'))*/,
              showRecipes: [],
              showAddRecipe: false
            };
          }

          handleOnClickShowIng(i) {
            const showRecipes = this.state.showRecipes.slice(); // modo correcto de copiar un array en javascript
            showRecipes[i] = !showRecipes[i]; // niega lo que había
            this.setState({ showRecipes : showRecipes });
          }

          handleOnClickAddRecipeView() {
            this.setState({ showAddRecipe : true });
      }

      handleCloseAddRecipe() {
       this.setState({ showAddRecipe : false });
      }

      handleAddRecipe(fields) {
        /* ¿Guardo la nueva receta en el localStorage y después actualizo el state.recipes?  */
        /* Debe haber una mejor forma de hacer esto: */
        localStorage.setItem("recipes", JSON.stringify(this.state.recipes.concat([{name: fields.name, ingredients: fields.ingredients }])))
        this.setState({
          recipes: JSON.parse(localStorage.getItem('recipes')),
          showAddRecipe : false
        });
     }

          render() {
            return (
        <div className="page">
            <header>
                <h1>The Most Wonderful Recipe Box!</h1>
            </header>
            <div className="recipesList">
                {
               /* Manejar el caso de que no haya ninguna receta */ 
               
               (this.state.recipes) ? this.state.recipes.map((recipe, i) => { return (
                <Recipe name={recipe.name} ingredients={recipe.ingredients} onClickShowIng={() => this.handleOnClickShowIng(i)} showIng={this.state.showRecipes[i]} key={recipe.name + i} /> )}) : 'Todavía no hay recetas.' 
              } 
                <button onClick={() => this.handleOnClickAddRecipeView() }>Add recipe</button>
            </div>
            { (this.state.showAddRecipe) ?
               <AddRecipe
                 onClickAddRecipe={(fields) => this.handleAddRecipe(fields)}
                 cancel={() => this.handleCloseAddRecipe() } /> :
               <div></div>  
            }
            <footer>
                <p>2018 - Made with love and perseverance.</p>
            </footer>
        </div>
        ) } }
/* Arriba, fue necesario incluir (fields)  en <AddRecipe onClickAddRecipe={(fields) => ... */

        function Recipe(props){ return (
        <div className="recipe">
            <div className="name" onClick={props.onClickShowIng}>
                <h2>{props.name}</h2>
            </div>
            { (props.showIng === true)?
            <Ingredients ingredients={props.ingredients.split(',')} /> :
            <div></div> }
        </div>
        )
        }

        function Ingredients (props) { 
          return (
        <div className="ingredients">
            <h3>Ingredients</h3> {props.ingredients.map((ingr) => { return (
            <p key={ingr}>{ingr}</p>) })}
        </div> ) 
        }

        function AddRecipe(props) {
            return (
            <div className="newRecipeForm">
                <AddRecipeForm onClickAddRecipe={props.onClickAddRecipe} cancel={props.cancel} />
            </div>
            )
        }

/* https://reactjs.org/docs/forms.html */
/* How to code a form in React - youtube */
class AddRecipeForm extends React.Component {
  constructor() {
    super();
    this.state = {name: '', ingredients: ''};
    this.handleChange = this.handleChange.bind(this);
    this.handleSubmit = this.handleSubmit.bind(this);
  }

  /* To update the state while the user types */
  handleChange(event) {
    this.setState({
      [event.target.name]: event.target.value
    });
  }

  handleSubmit(event) {
    this.props.onClickAddRecipe(this.state); // ¿Por acá le pasa los datos al componente de una jerarquía superior? Sí, this.state serían los fields (y a la vez deja de mostrarse el recuadro porque esta función pone en false el estado showAddRecipe, ¿está bien hacerlo así?)
    event.preventDefault();
  }

  render() {
    return (
      <form onSubmit={this.handleSubmit}>
        <div>
        <label>
          Name:
          <input
            name="name"
            placeholder="recipe name" type="text"
            value={this.state.name}
            onChange={this.handleChange}
          />
        </label>
          </div>
        <div>
        <label>
          Ingredients:
          <input
            name="ingredients"
            placeholder="ingredients" type="text"
            value={this.state.ingredients}
            onChange={this.handleChange}
          />
        </label>
          </div>
        <input type="submit" value="Submit"/>
        <button onClick={() => this.props.cancel() }>Cancel</button>
        <div>Nombre: {this.state.name}, Ingredientes: {this.state.ingredients}</div>
      </form>
    );
  }
          /* Fue necesario incluir () luego de this.props.cancel, de otra manera ejecutaba el handleSubmit
¿Por qué acá sí es necesario y en otras partes es necesario no incluirlo?
        */
}

        ReactDOM.render(
        <Page/>, document.getElementById('root') );

    </script>
</body>

</html>
